# GitHub Actions Setup Guide

This guide explains how to set up GitHub Actions workflows for the EVR Scanner to run automatically and send email notifications.

## Overview

The EVR Scanner includes three GitHub Actions workflows:

1. **Daily Scanner** - Runs Monday-Friday at 9:15 AM ET
2. **Weekly Scanner** - Runs Mondays at 9:30 AM ET  
3. **Manual Scanner** - Triggered manually with custom parameters

## Prerequisites

### 1. GitHub Repository
- Push your EVR code to a GitHub repository
- Ensure the repository is public or you have GitHub Actions enabled

### 2. Gmail App Password
You need a Gmail app password for email notifications:

1. Go to [Google Account Settings](https://myaccount.google.com/)
2. Navigate to **Security** → **2-Step Verification** (enable if not already)
3. Go to **App passwords**
4. Generate a new app password for "Mail"
5. Copy the 16-character password

### 3. GitHub Secrets
Add the following secrets to your GitHub repository:

1. Go to your repository → **Settings** → **Secrets and variables** → **Actions**
2. Click **New repository secret**
3. Add these secrets:

```
EMAIL_USERNAME: your-email@gmail.com
EMAIL_PASSWORD: your-16-character-app-password
```

## Workflow Details

### Daily Scanner (`daily-scanner.yml`)

**Schedule:** Monday-Friday at 9:15 AM ET (1:15 PM UTC)
**Purpose:** Daily trading signal generation

**Features:**
- Scans 200 tickers
- Shows top 30 signals
- Generates comprehensive daily report
- Sends email notification
- Creates GitHub issue on failure
- Uploads results as artifacts

**Email Content:**
- Daily summary statistics
- Signal breakdown by type
- Top 10 signals by expected return
- Risk and confidence analysis
- Market sentiment indicators

### Weekly Scanner (`weekly-scanner.yml`)

**Schedule:** Mondays at 9:30 AM ET (1:30 PM UTC)
**Purpose:** Comprehensive weekly market analysis

**Features:**
- Scans 500 tickers
- Shows top 50 signals
- Generates detailed weekly report
- Sends email notification
- Creates GitHub issue on failure
- Uploads results as artifacts (90-day retention)

**Email Content:**
- Weekly summary statistics
- Signal type breakdown with averages
- Top 20 signals by expected return
- Detailed risk and confidence analysis
- Market sentiment and quality metrics

### Manual Scanner (`manual-scanner.yml`)

**Trigger:** Manual dispatch with custom parameters
**Purpose:** On-demand scanning with custom settings

**Parameters:**
- `max_tickers`: Number of tickers to scan (default: 100)
- `top_signals`: Number of top signals to display (default: 20)
- `log_level`: Logging level (DEBUG, INFO, WARNING, ERROR)
- `use_cache`: Use cached ticker list (true/false)
- `email_notification`: Send email notification (true/false)

**Features:**
- Customizable scan parameters
- Optional email notification
- Manual trigger from GitHub Actions tab
- Uploads results as artifacts

## Setup Instructions

### 1. Enable GitHub Actions

1. Go to your repository → **Actions** tab
2. Click **I understand my workflows, go ahead and enable them**
3. Verify the workflows are visible

### 2. Configure Email Secrets

1. Go to **Settings** → **Secrets and variables** → **Actions**
2. Add `EMAIL_USERNAME` and `EMAIL_PASSWORD` secrets
3. Use your Gmail address and app password

### 3. Test the Workflows

1. Go to **Actions** tab
2. Select **Manual EVR Scanner**
3. Click **Run workflow**
4. Choose parameters and click **Run workflow**
5. Monitor the execution and check email

### 4. Verify Scheduled Runs

1. Check **Actions** tab for scheduled runs
2. Daily scanner runs Monday-Friday at 9:15 AM ET
3. Weekly scanner runs Mondays at 9:30 AM ET
4. Monitor execution logs and email delivery

## Email Notifications

### Daily Email Format

```
Subject: EVR Daily Trading Signals - [Run Number]

Daily EVR Trading Signals Report

Scan completed successfully at [Run Number].

Please find the detailed report in the attached summary file.

Files generated:
- CSV with all signals
- JSON with detailed data
- Summary text file

Repository: https://github.com/[username]/evr
Workflow: https://github.com/[username]/evr/actions/runs/[run-id]

---
Generated by EVR Scanner GitHub Action
```

### Weekly Email Format

```
Subject: EVR Weekly Trading Signals - [Run Number]

EVR Weekly Trading Signals Report

Weekly comprehensive scan completed successfully at [Run Number].

This report includes:
- Comprehensive market analysis
- Top 20 signals by expected return
- Detailed risk and confidence analysis
- Market sentiment indicators
- Signal quality metrics

Please find the detailed report in the attached summary file.

Files generated:
- CSV with all signals
- JSON with detailed data
- Summary text file

Repository: https://github.com/[username]/evr
Workflow: https://github.com/[username]/evr/actions/runs/[run-id]

---
Generated by EVR Scanner GitHub Action
```

## Troubleshooting

### Common Issues

#### 1. Email Not Sending
**Problem:** Emails not received
**Solutions:**
- Verify `EMAIL_USERNAME` and `EMAIL_PASSWORD` secrets are correct
- Check Gmail app password is valid
- Ensure 2-factor authentication is enabled
- Check GitHub Actions logs for email errors

#### 2. Workflow Failures
**Problem:** Workflows failing to run
**Solutions:**
- Check GitHub Actions logs for error details
- Verify Python dependencies are available
- Check network connectivity to data sources
- Ensure repository has necessary permissions

#### 3. Schedule Not Running
**Problem:** Scheduled workflows not triggering
**Solutions:**
- Verify cron schedule syntax
- Check GitHub Actions is enabled
- Ensure repository is active (not archived)
- Check for workflow syntax errors

#### 4. Missing Artifacts
**Problem:** Scan results not uploaded
**Solutions:**
- Check file paths in workflow
- Verify scan completed successfully
- Check artifact upload permissions
- Review retention settings

### Debug Steps

#### 1. Check Workflow Logs
1. Go to **Actions** tab
2. Click on failed workflow run
3. Review step-by-step logs
4. Look for error messages

#### 2. Test Email Configuration
```bash
# Test email sending manually
python -c "
import smtplib
from email.mime.text import MIMEText

# Test SMTP connection
server = smtplib.SMTP('smtp.gmail.com', 587)
server.starttls()
server.login('your-email@gmail.com', 'your-app-password')
print('Email configuration successful')
server.quit()
"
```

#### 3. Verify Dependencies
```bash
# Test scanner locally
python cli_official_scanner.py --max-tickers 10 --log-level DEBUG
```

#### 4. Check Secrets
1. Go to **Settings** → **Secrets and variables** → **Actions**
2. Verify secrets exist and are correctly named
3. Ensure no extra spaces or characters

## Customization

### Modify Schedule
Edit the cron expressions in workflow files:

```yaml
# Daily at 9:15 AM ET (1:15 PM UTC)
- cron: '15 13 * * 1-5'

# Weekly on Mondays at 9:30 AM ET (1:30 PM UTC)
- cron: '30 13 * * 1'
```

### Change Email Recipients
Modify the `to` field in email steps:

```yaml
to: anshuman264@gmail.com,another@email.com
```

### Adjust Scan Parameters
Modify the scanner command in workflow steps:

```yaml
python cli_official_scanner.py \
  --max-tickers 300 \
  --top 40 \
  --output-prefix "custom_$(date +%Y%m%d)" \
  --log-level INFO
```

### Add More Notifications
Add additional notification steps:

```yaml
- name: Send Slack Notification
  uses: 8398a7/action-slack@v3
  with:
    status: ${{ job.status }}
    channel: '#trading'
    webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

## Security Considerations

### Secrets Management
- Never commit email passwords to code
- Use GitHub Secrets for sensitive data
- Rotate app passwords regularly
- Monitor secret usage

### Repository Permissions
- Use least-privilege access
- Review workflow permissions
- Monitor workflow executions
- Audit secret access

### Data Protection
- Scan results may contain sensitive information
- Consider data retention policies
- Review artifact storage settings
- Monitor access logs

## Monitoring

### GitHub Actions Dashboard
- Monitor workflow execution status
- Review success/failure rates
- Check execution times
- Monitor resource usage

### Email Delivery
- Verify email delivery
- Check spam folders
- Monitor email formatting
- Test email attachments

### Performance Metrics
- Track scan completion times
- Monitor signal generation rates
- Review error frequencies
- Analyze resource consumption

## Best Practices

### 1. Regular Maintenance
- Update dependencies regularly
- Review workflow logs monthly
- Test workflows after changes
- Monitor performance metrics

### 2. Error Handling
- Implement comprehensive error handling
- Create GitHub issues on failures
- Send failure notifications
- Log detailed error information

### 3. Performance Optimization
- Use appropriate scan parameters
- Implement caching strategies
- Monitor resource usage
- Optimize workflow steps

### 4. Documentation
- Keep workflow documentation updated
- Document customizations
- Maintain troubleshooting guides
- Update setup instructions

This setup provides a robust, automated trading signal generation system with comprehensive monitoring and notification capabilities.
